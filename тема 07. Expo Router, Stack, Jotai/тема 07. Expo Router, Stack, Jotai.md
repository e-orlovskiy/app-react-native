# –¢–µ–º–∞ 07. –†–∞–±–æ—Ç–∞ —Å Expo Router, Stack, Jotai

### üßä–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npx expo install expo-router jotai
```

### üßä–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
üìÇ app
‚îÇ‚îÄ‚îÄ üìÇ (auth)                #  –ì—Ä—É–ø–ø–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ login.tsx         #  –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ register.tsx      #  –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ‚îÄ‚îÄ üìÇ (app)                 #  –ì—Ä—É–ø–ø–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.tsx         #  –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ‚îÄ‚îÄ üìÑ _layout.tsx           #  –û—Å–Ω–æ–≤–Ω–æ–π –º–∞–∫–µ—Ç (layout) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ‚îÄ‚îÄ üìÑ index.tsx             #  –ö–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ‚îÄ‚îÄ üìÑ +not-found.tsx        #  –°—Ç—Ä–∞–Ω–∏—Ü–∞ 404 (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
‚îÇ‚îÄ‚îÄ üìÇ state                 #  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.ts           #  –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```

### üßäJotai: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–π—Ç–∞–º–∏

**Jotai** - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ç–µ–π—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ç–æ–º—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. –ê—Ç–æ–º - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Jotai:

- **–ê—Ç–æ–º—ã**: –≠—Ç–æ –∫—É—Å–æ—á–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.
- **–•—É–∫¬†`useAtom`**: –ü–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ç–æ–º–∞.
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: Jotai –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, Redux Toolkit.

–°–æ–∑–¥–∞–¥–∏–º –∞—Ç–æ–º –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```ts
// app/state/auth.ts
import { atom } from 'jotai'

export const isAuthenticatedAtom = atom<boolean>(false) // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- **`atom`**: –°–æ–∑–¥–∞—ë—Ç –∞—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- **`isAuthenticatedAtom`**: –ê—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –±—É–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –Ω–µ—Ç).

### üßä–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ Jotai

Jotai –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∞—Ç–æ–º—ã. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API.

–ü—Ä–∏–º–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∞—Ç–æ–º–∞:

```ts
import { atom } from 'jotai'

// –ê—Ç–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
export const userDataAtom = atom(async () => {
	const response = await fetch('https://api.example.com/user')
	const data = await response.json()
	return data
})
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∞—Ç–æ–º–∞

```tsx
import { useAtom } from 'jotai'
import { userDataAtom } from './state/user'

function UserComponent() {
	const [userData] = useAtom(userDataAtom)

	if (!userData) {
		return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
	}

	return (
		<div>
			<h1>{userData.name}</h1>
			<p>{userData.email}</p>
		</div>
	)
}
```

### üßä–†–æ—É—Ç–∏–Ω–≥ –≤ Expo Router

Expo Router –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ¬†`app`¬†—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–æ–º, –∞ –∏–º—è —Ñ–∞–π–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç—å.

**–ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤:**

- **`(auth)`**: –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ª–æ–≥–∏–Ω, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è).
- **`(app)`**: –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω).

### üßä–ö–æ—Ä–Ω–µ–≤–æ–π –º–∞–∫–µ—Ç (–ª—ç–π–∞—É—Ç) (`_layout.tsx`)

–§–∞–π–ª¬†`_layout.tsx`¬†–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

```tsx
// app/_layout.tsx
import { Stack } from 'expo-router'
import { useAtom } from 'jotai'
import { isAuthenticatedAtom } from './state/auth'

export default function RootLayout() {
	const [isAuthenticated] = useAtom(isAuthenticatedAtom)

	return (
		<Stack>
			{!isAuthenticated ? (
				<Stack.Screen name='(auth)' options={{ headerShown: false }} />
			) : (
				<Stack.Screen name='(app)' options={{ headerShown: false }} />
			)}
			<Stack.Screen name='+not-found' options={{ headerShown: false }} />
		</Stack>
	)
}
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- **`Stack`**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏.
- **`useAtom`**: –•—É–∫ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é Jotai.
- **`isAuthenticated`**: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
- **`Stack.Screen`**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ —ç–∫—Ä–∞–Ω—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### üßä–≠–∫—Ä–∞–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–õ–æ–≥–∏–Ω** `login.tsx`

```tsx
// app/(auth)/login.tsx
import { Link, router } from 'expo-router'
import { useAtom } from 'jotai'
import { isAuthenticatedAtom } from '../state/auth'
import { Button, Text, View } from 'react-native'

export default function Login() {
	const [, setIsAuthenticated] = useAtom(isAuthenticatedAtom)

	const handleLogin = () => {
		setIsAuthenticated(true) // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
		router.replace('/(app)') // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
	}

	return (
		<View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
			<Text>Login Screen</Text>
			<Button title='Login' onPress={handleLogin} />
			<Link href='/register'>Go to Register</Link>
		</View>
	)
}
```

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** `register.tsx`

```tsx
// app/(auth)/register.tsx
import { Link, router } from 'expo-router'
import { useAtom } from 'jotai'
import { isAuthenticatedAtom } from '../state/auth'
import { Button, Text, View } from 'react-native'

export default function Register() {
	const [, setIsAuthenticated] = useAtom(isAuthenticatedAtom)

	const handleRegister = () => {
		setIsAuthenticated(true) // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
		router.replace('/(app)') // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
	}

	return (
		<View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
			<Text>Register Screen</Text>
			<Button title='Register' onPress={handleRegister} />
			<Link href='/login'>Go to Login</Link>
		</View>
	)
}
```

### üßä–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω

**–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (`index.tsx`)

```tsx
// app/(app)/index.tsx
import { Link, router } from 'expo-router'
import { useAtom } from 'jotai'
import { isAuthenticatedAtom } from '../state/auth'
import { Button, Text, View } from 'react-native'

export default function Home() {
	const [, setIsAuthenticated] = useAtom(isAuthenticatedAtom)

	const handleLogout = () => {
		setIsAuthenticated(false) // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
		router.replace('/(auth)/login') // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
	}

	return (
		<View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
			<Text>Home Screen</Text>
			<Button title='Logout' onPress={handleLogout} />
		</View>
	)
}
```

### üßä–≠–∫—Ä–∞–Ω 404 (Not Found)

```tsx
// app/+not-found.tsx
import { Link } from 'expo-router'
import { Text, View } from 'react-native'

export default function NotFound() {
	return (
		<View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
			<Text>404 - Not Found</Text>
			<Link href='/'>Go to Home</Link>
		</View>
	)
}
```

### üßä–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (`index.tsx`)

```tsx
// app/index.tsx
import { Redirect } from 'expo-router'
import { useAtom } from 'jotai'
import { isAuthenticatedAtom } from './state/auth'

export default function Index() {
	const [isAuthenticated] = useAtom(isAuthenticatedAtom)

	if (isAuthenticated) {
		return <Redirect href='/(app)' />
	} else {
		return <Redirect href='/(auth)/login' />
	}
}
```

### üßä–ò—Ç–æ–≥–∏:

- **Jotai**: –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- **Expo Router**: –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏.
- **–ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤**: –õ–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è.
