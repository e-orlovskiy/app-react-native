# Async Storage, –∑–∞–ø—Ä–æ—Å—ã —Å headers/cookies, –í–≤–µ–¥–µ–Ω–∏–µ –≤ ImagePicker

## üßä AsyncStorage

**AsyncStorage**¬†‚Äî —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á–µ–π –∏ –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –≤ React Native. –û–Ω–æ –ø–æ—Ö–æ–∂–µ –Ω–∞¬†`localStorage`¬†–≤ –≤–µ–±–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://react-native-async-storage.github.io/async-storage/docs/install/

### ‚ö°–£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –° –ø–æ–º–æ—â—å—é `npm`

```
npm install @react-native-async-storage/async-storage
```

2. –° –ø–æ–º–æ—â—å—é `expo cli`:

```
npx expo install @react-native-async-storage/async-storage
```

### ‚ö°–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**Async Storage**¬†–º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç—å¬†`string` –¥–∞–Ω–Ω—ã–µ. –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Ö —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å. –î–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ JSON, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`JSON.stringify()` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏¬†`JSON.parse()` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.

1. –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```tsx
import AsyncStorage from '@react-native-async-storage/async-storage'
```

2. –•—Ä–∞–Ω–µ–Ω–∏–µ.

–ú–µ—Ç–æ–¥ `setItem()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç), —Ç–∞–∫ –∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–∫–æ–≥–¥–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç).

```tsx
const storeData = async value => {
	try {
		await AsyncStorage.setItem('my-key', value)
	} catch (e) {
		// saving error
	}
}
```

```tsx
const storeData = async value => {
	try {
		const jsonValue = JSON.stringify(value)
		await AsyncStorage.setItem('my-key', jsonValue)
	} catch (e) {
		// saving error
	}
}
```

3. –ß—Ç–µ–Ω–∏–µ
   –ú–µ—Ç–æ–¥ `getItem` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ª–∏–±–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞–π–¥–µ–Ω—ã, –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è¬†`null` –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.

```tsx
const getData = async () => {
	try {
		const value = await AsyncStorage.getItem('my-key')
		if (value !== null) {
			// value previously stored
		}
	} catch (e) {
		// error reading value
	}
}
```

```tsx
const getData = async () => {
	try {
		const jsonValue = await AsyncStorage.getItem('my-key')
		return jsonValue != null ? JSON.parse(jsonValue) : null
	} catch (e) {
		// error reading value
	}
}
```

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## üßä –†–∞–±–æ—Ç–∞ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–∫—É–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏)

–†–∞–±–æ—Ç–∞ —Å –∫—É–∫–∏ (cookies) –≤¬†**React Native**¬†–æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ä–∞–±–æ—Ç—ã —Å –∫—É–∫–∏ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ React Native —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ, –∞ –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –≥–¥–µ –∫—É–∫–∏ —è–≤–ª—è—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í React Native –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫—É–∫–∏, –∫–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–æ –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ API.

–°–∞–º—ã–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ—à–µ–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `react-native-cookies`

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:

```
npm install @react-native-cookies/cookies
```

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```tsx
import CookieManager from '@react-native-cookies/cookies'

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–∏
const setCookie = async () => {
	await CookieManager.set('https://example.com', {
		name: 'myCookie',
		value: '12345',
		domain: 'example.com',
		path: '/',
		version: '1',
		expiration: '2025-05-05T12:00:00.00Z'
	})
	console.log('–ö—É–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã')
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫–∏
const getCookie = async () => {
	const cookies = await CookieManager.get('https://example.com')
	console.log('–ö—É–∫–∏:', cookies)
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∫—É–∫–∏
const clearCookie = async () => {
	await CookieManager.clearAll()
	console.log('–í—Å–µ –∫—É–∫–∏ —É–¥–∞–ª–µ–Ω—ã')
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
setCookie()
getCookie()
clearCookie()
```

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä¬†`axios`¬†–∏–ª–∏¬†`fetch`, –≤—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—Ç—å –∫—É–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

–ü—Ä–∏–º–µ—Ä —Å `axios`:

```tsx
import axios from 'axios'

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–∏ –≤—Ä—É—á–Ω—É—é
axios.defaults.headers.common['Cookie'] = 'myCookie=12345'

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å –∫—É–∫–∏
axios
	.get('https://example.com/api/data')
	.then(response => {
		console.log('–û—Ç–≤–µ—Ç:', response.data)
	})
	.catch(error => {
		console.error('–û—à–∏–±–∫–∞:', error)
	})
```

–ü—Ä–∏–º–µ—Ä —Å `fetch`:

```tsx
fetch('https://example.com/api/data', {
	headers: {
		Cookie: 'myCookie=12345'
	}
})
	.then(response => response.json())
	.then(data => {
		console.log('–û—Ç–≤–µ—Ç:', data)
	})
	.catch(error => {
		console.error('–û—à–∏–±–∫–∞:', error)
	})
```

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—É–∫–∏ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥–æ–π–¥—ë—Ç `AsyncStorage`, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã—à–µ

```tsx
import AsyncStorage from '@react-native-async-storage/async-storage'

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏
const saveCookie = async (cookie: string) => {
	try {
		await AsyncStorage.setItem('myCookie', cookie)
		console.log('–ö—É–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã')
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫—É–∫–∏:', error)
	}
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫–∏
const getCookie = async () => {
	try {
		const cookie = await AsyncStorage.getItem('myCookie')
		if (cookie !== null) {
			console.log('–ö—É–∫–∏:', cookie)
			return cookie
		}
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É–∫–∏:', error)
	}
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
saveCookie('myCookie=12345')
getCookie()
```

–í¬†**React Native**¬†–≤—ã¬†**–Ω–µ —Å–º–æ–∂–µ—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP-only –∫—É–∫–∏**, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ React Native —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ, –∞ –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –≥–¥–µ HTTP-only –∫—É–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è —á–µ—Ä–µ–∑ JavaScript.

–ï—Å–ª–∏ –≤–∞–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP-only –∫—É–∫–∏, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –∫—É–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–°. –û–¥–Ω–∞–∫–æ —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π –∏ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥.

–°–∞–º—ã–º–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –∏ —á–∞—Å—Ç—ã–º —Ä–µ—à–µ–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏–±–æ –ø–µ—Ä–µ–¥–∞—á–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ª–∏–±–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –º–æ–¥—É–ª–µ–π.

–ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –º–µ—Ç–æ–¥–æ–º `fetch`:

```tsx
import AsyncStorage from '@react-native-async-storage/async-storage'

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
const saveToken = async (token: string) => {
	await AsyncStorage.setItem('authToken', token)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
const getToken = async () => {
	return await AsyncStorage.getItem('authToken')
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
const fetchData = async () => {
	const token = await getToken()
	const response = await fetch('https://example.com/api/data', {
		headers: {
			Authorization: `Bearer ${token}`
		}
	})
	const data = await response.json()
	console.log(data)
}
```

–ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –º–µ—Ç–æ–¥–æ–º `axios`:

```tsx
import AsyncStorage from '@react-native-async-storage/async-storage'
import axios from 'axios'

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
const saveToken = async (token: string) => {
	await AsyncStorage.setItem('authToken', token)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
const getToken = async () => {
	return await AsyncStorage.getItem('authToken')
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
const fetchData = async () => {
	try {
		const token = await getToken()

		// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ axios —Å —Ç–æ–∫–µ–Ω–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
		const response = await axios.get('https://example.com/api/data', {
			headers: {
				Authorization: `Bearer ${token}`
			}
		})

		console.log('–û—Ç–≤–µ—Ç:', response.data)
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error)
	}
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const exampleUsage = async () => {
	await saveToken('your-auth-token-here') // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
	await fetchData() // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º
}

exampleUsage()
```

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä—ã:

```tsx
import AsyncStorage from '@react-native-async-storage/async-storage'
import axios from 'axios'

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ axios
const api = axios.create({
	baseURL: 'https://example.com'
})

// –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
api.interceptors.request.use(async config => {
	const token = await AsyncStorage.getItem('authToken')
	if (token) {
		config.headers.Authorization = `Bearer ${token}`
	}
	return config
})

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
const fetchData = async () => {
	try {
		const response = await api.get('/api/data')
		console.log('–û—Ç–≤–µ—Ç:', response.data)
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error)
	}
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const exampleUsage = async () => {
	await AsyncStorage.setItem('authToken', 'your-auth-token-here') // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
	await fetchData() // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
}

exampleUsage()
```

–ü—Ä–∏–º–µ—Ä –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```ts
import express, { Request, Response, NextFunction } from 'express'

const app = express()
const port = 3000

// Middleware –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
const extractToken = (req: Request, res: Response, next: NextFunction) => {
	// –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization
	const authHeader = req.headers['authorization']

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –æ–Ω —Å "Bearer "
	if (authHeader && authHeader.startsWith('Bearer ')) {
		// –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω (—É–±–∏—Ä–∞–µ–º "Bearer " –∏–∑ —Å—Ç—Ä–æ–∫–∏)
		const token = authHeader.split(' ')[1]
		// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –æ–±—ä–µ–∫—Ç–µ –∑–∞–ø—Ä–æ—Å–∞ (req) –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
		req.token = token
		next() // –ü–µ—Ä–µ–¥–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É middleware –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
	} else {
		// –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
		res.status(401).json({ message: 'Unauthorized: Token is missing or invalid' })
	}
}

// –ü—Ä–∏–º–µ—Ä –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
app.get('/api/data', extractToken, (req: Request, res: Response) => {
	// –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ req.token
	const token = req.token

	// –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ jsonwebtoken
	console.log('–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω:', token)

	// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö)
	res.json({ message: '–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω', token })
})

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(port, () => {
	console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${port}`)
})
```
